# AI 项目综合说明

## 项目概述

本项目是一个综合性的应用程序平台，包含三个主要组成部分：

1. **后端管理系统** ([gin-vue-admin](file:///Volumes/MACOS/Users/sado/code/cincore/AI/gin-vue-admin)): 基于 Gin-Vue-Admin 框架构建的后台管理平台
2. **微信小程序前端** ([wechat](file:///Volumes/MACOS/Users/sado/code/cincore/AI/wechat)): 基于 UniApp 构建的微信小程序应用
3. **数据库和缓存服务**: 使用 Docker 部署的 PostgreSQL 和 Redis 服务

## 项目架构

```
AI 项目
├── 后端服务 (gin-vue-admin/server)
│   ├── API 接口服务
│   ├── 数据库管理
│   ├── 用户权限管理
│   └── 业务逻辑处理
├── 管理界面 (gin-vue-admin/web)
│   ├── 管理员后台
│   ├── 数据可视化
│   └── 系统配置管理
├── 微信小程序 (wechat)
│   ├── 用户端界面
│   ├── 微信授权登录
│   └── 业务功能展示
└── 基础设施
    ├── PostgreSQL 数据库
    ├── Redis 缓存服务
    └── Docker 容器化部署
```

## 技术栈

### 后端技术栈
- **语言**: Go
- **框架**: Gin
- **ORM**: GORM
- **数据库**: PostgreSQL
- **缓存**: Redis
- **API 文档**: Swagger
- **构建工具**: Go Modules

### 管理界面技术栈
- **框架**: Vue 3
- **UI 库**: Element Plus
- **状态管理**: Pinia
- **构建工具**: Vite
- **包管理**: Yarn

### 微信小程序技术栈
- **框架**: UniApp
- **语言**: TypeScript
- **UI 库**: sard-uniapp
- **状态管理**: Pinia
- **构建工具**: Vite
- **包管理**: pnpm

## 功能模块

### 后端管理系统
- 用户管理
- 角色权限管理
- 菜单管理
- API 管理
- 系统配置
- 日志管理
- 数据字典

### 微信小程序
- 微信授权登录
- 用户信息管理
- 业务功能展示
- 数据交互

## 项目结构

```
AI/
├── docs/                    # 项目文档
│   ├── 项目综合说明.md       # 综合说明文档（本文档）
│   └── 独立微信用户体系说明.md # 微信用户体系文档
├── gin-vue-admin/          # 后端管理系统
│   ├── server/             # 后端服务
│   └── web/                # 管理界面
├── wechat/                 # 微信小程序前端
├── backups/                # 数据库备份
├── sql/                    # SQL 脚本
├── docker-compose.yml      # Docker 配置文件
└── sync_db.sh              # 数据库同步脚本
```

## Docker 环境初始化

### 启动 Docker 容器

在项目根目录下执行以下命令启动 PostgreSQL 和 Redis 容器：

```bash
# 启动所有服务
docker-compose up -d

# 查看容器状态
docker ps
```

预期会看到两个正在运行的容器：
- `gin-vue-admin-db` (PostgreSQL 15)
- `gin-vue-admin-redis` (Redis 7)

### Docker 服务配置

#### PostgreSQL 配置：
- 容器名：gin-vue-admin-db
- 端口：5432（映射到本地 5432）
- 用户名：gva
- 密码：gva1234
- 数据库名：gva
- 数据持久化：pgdata volume

#### Redis 配置：
- 容器名：gin-vue-admin-redis
- 端口：6379（映射到本地 6379）
- 数据持久化：redisdata volume
- 启用 AOF 持久化

### Docker 常用命令

```bash
# 停止所有服务
docker-compose down

# 重启数据库
docker-compose restart db

# 重启 Redis
docker-compose restart redis

# 删除所有数据（谨慎操作，数据会丢失）
docker-compose down -v

# 查看数据库日志
docker-compose logs -f db

# 查看 Redis 日志
docker-compose logs -f redis
```

## 数据库初始化

### 数据库连接配置

确保 [gin-vue-admin/server/config.yaml](file:///Volumes/MACOS/Users/sado/code/cincore/AI/gin-vue-admin/server/config.yaml) 文件中的数据库配置正确：

```yaml
pgsql:
  path: 127.0.0.1
  port: "5432"
  config: sslmode=disable TimeZone=Asia/Shanghai
  db-name: gva1
  username: gva
  password: gva1234
  ...
```

### 初始化数据库表

进入后端服务目录并运行初始化命令：

```bash
# 进入后端服务目录
cd gin-vue-admin/server

# 安装依赖
go mod tidy

# 运行服务（首次运行会自动创建表结构）
go run main.go
```

### 数据库同步脚本

项目提供了 [sync_db.sh](file:///Volumes/MACOS/Users/sado/code/cincore/AI/sync_db.sh) 脚本用于数据库同步：

```bash
# 给脚本执行权限
chmod +x sync_db.sh

# 同步数据库到本地
./sync_db.sh

# 查看帮助信息
./sync_db.sh --help
```

该脚本会：
1. 导出数据库结构到 [sql/schema.sql](file:///Volumes/MACOS/Users/sado/code/cincore/AI/sql/schema.sql)
2. 导出完整数据库到 [sql/full_database.sql](file:///Volumes/MACOS/Users/sado/code/cincore/AI/sql/full_database.sql)
3. 创建备份到 [backups/](file:///Volumes/MACOS/Users/sado/code/cincore/AI/backups/) 目录
4. 自动清理旧备份（保留最近 10 个）

## 后端服务运行

### 配置微信小程序

在 [gin-vue-admin/server/config.yaml](file:///Volumes/MACOS/Users/sado/code/cincore/AI/gin-vue-admin/server/config.yaml) 中添加微信配置：

```yaml
system:
  wx-app-id: "你的微信小程序AppID"
  wx-app-secret: "你的微信小程序AppSecret"
```

### 运行后端服务

```bash
# 进入后端服务目录
cd gin-vue-admin/server

# 运行服务
go run main.go
```

服务启动后会显示：
- 默认自动化文档地址: http://127.0.0.1:8888/swagger/index.html
- 默认前端文件运行地址: http://127.0.0.1:8080

### 构建后端服务

```bash
# 构建可执行文件
go build -o server main.go

# 运行构建后的文件
./server
```

## 前端管理界面运行

### 安装依赖

```bash
# 进入前端目录
cd gin-vue-admin/web

# 安装依赖（推荐使用 yarn）
yarn install
# 或者使用 npm
npm install
```

### 运行开发服务器

```bash
# 启动开发服务器
yarn serve
# 或者
npm run serve
```

### 构建生产版本

```bash
# 构建生产版本
yarn build
# 或者
npm run build
```

## 微信小程序运行

### 安装依赖

```bash
# 进入微信小程序目录
cd wechat

# 安装依赖（必须使用 pnpm）
pnpm install
```

### 运行开发服务器

```bash
# 运行微信小程序开发服务器
pnpm dev

# 运行 H5 开发服务器
pnpm dev:h5
```

### 构建生产版本

```bash
# 构建微信小程序生产版本
pnpm build

# 构建 H5 生产版本
pnpm build:h5
```

## 启动流程

### 1. 启动基础设施
```bash
docker-compose up -d
```

### 2. 启动后端服务
```bash
cd gin-vue-admin/server
go run main.go
```

### 3. 启动管理界面
```bash
cd gin-vue-admin/web
npm run serve
```

### 4. 启动微信小程序
```bash
cd wechat
pnpm dev
```

## 数据库设计

### 主要数据表
- `sys_users`: 系统管理员用户表
- `User`: 微信小程序用户表
- `sys_authorities`: 角色权限表
- `sys_menus`: 系统菜单表
- `sys_apis`: API 接口表

### 数据库连接
- Host: localhost
- Port: 5432
- Database: gva1
- Username: gva
- Password: gva1234

## 微信集成

### 微信登录流程
1. 用户在微信小程序中点击登录
2. 小程序调用 `uni.login()` 获取 code
3. 将 code 发送到后端 `/api/wx/Login` 接口
4. 后端通过 code 向微信服务器换取 openid
5. 根据 openid 查找或创建用户
6. 生成 JWT token 返回给前端
7. 前端保存 token 并用于后续请求

### 微信配置
在 `gin-vue-admin/server/config.yaml` 中配置:
```yaml
system:
  wx-app-id: "你的微信小程序AppID"
  wx-app-secret: "你的微信小程序AppSecret"
```

## 开发规范

### 代码规范
- 后端: 遵循 Go 语言编码规范
- 前端: 遵循 Vue 3 和 TypeScript 编码规范
- 小程序: 遵循 UniApp 编码规范

### Git 提交规范
- 使用 conventional commits 规范
- 提交信息格式: `<type>(<scope>): <subject>`

### 分支管理
- `main`: 主分支，稳定版本
- `develop`: 开发分支
- `feature/*`: 功能开发分支
- `hotfix/*`: 紧急修复分支

## 部署说明

### 环境要求
- Docker & Docker Compose
- Go 1.22+
- Node.js 18+
- pnpm 7.30+
- PostgreSQL 客户端工具

### 生产部署
1. 构建后端服务:
   ```bash
   cd gin-vue-admin/server
   go build -o server main.go
   ```

2. 构建管理界面:
   ```bash
   cd gin-vue-admin/web
   npm run build
   ```

3. 构建微信小程序:
   ```bash
   cd wechat
   pnpm build
   ```

4. 部署 Docker 服务:
   ```bash
   docker-compose up -d
   ```

## 维护说明

### 数据库维护
- 定期备份: 使用 `sync_db.sh` 脚本
- 数据清理: 根据业务需求定期清理无用数据
- 性能优化: 定期分析慢查询并优化索引

### 日志管理
- 后端日志: 位于 `gin-vue-admin/server/log/` 目录
- Docker 日志: 使用 `docker-compose logs` 查看
- 应用日志: 根据各应用的日志配置查看

### 监控告警
- 服务健康检查: `/health` 接口
- 性能监控: 集成 Prometheus 和 Grafana
- 错误告警: 集成 Sentry 或其他错误追踪系统

## 注意事项

1. 确保本地 5432 和 6379 端口未被占用
2. 生产环境建议为 Redis 设置密码
3. 微信小程序需要在微信公众平台配置正确的 AppID 和 AppSecret
4. 数据库使用 PostgreSQL，确保已安装对应的客户端工具
5. 前端项目使用 yarn 管理依赖，微信小程序使用 pnpm 管理依赖

## 故障排除

### 数据库连接失败

1. 检查 Docker 容器是否正常运行
2. 确认 [config.yaml](file:///Volumes/MACOS/Users/sado/code/cincore/AI/gin-vue-admin/server/config.yaml) 中的数据库配置是否正确
3. 检查防火墙设置是否阻止了端口访问

### 微信登录失败

1. 确认微信 AppID 和 AppSecret 配置正确
2. 检查微信公众平台是否正确配置了服务器域名
3. 确认服务器网络可以访问微信 API

### 前端页面空白

1. 检查后端服务是否正常运行
2. 确认前端配置的 API 地址是否正确
3. 查看浏览器控制台是否有错误信息

### API 接口访问 401 错误

1. 检查 JWT Token 是否过期
2. 确认请求头是否包含正确的 Authorization 字段
3. 验证用户权限是否足够